### Information Gathering
• In web environments, information gathering includes machines, applications, databases, users, and the relationships between them.
• We already know:
	• Analyzing the network for machines.
		• nmap -sn IP-subnet/24
		• nmap –sn HOST
	• Finding out which ports are open
		• nmap HOST 
	• Determining the software version
		• nmap -sV -O  HOST 

## WAF (Web Application Firewall)
• It is necessary to detect the presence of firewalls, even before scanning the software version.
• A WAF (Web Application Firewall) is software or a device that checks packets sent to a web server.
• A WAF can identify and block malicious packets.
• Internally, it uses regular expressions for known formats.
• It is important to detect WAF, IDS, IPS as early as possible.

We can use nmap to detect a WAF:
- nmap -p 80,443 --script=http-waf-detect (HOST)
- It also has a script for identification:
- nmap -p 80,443 --script=http-waf-fingerprint (HOST)
- There are specific tools as well:
- wafw00f (HOST)

- To detect a WAF, requests are sent, and their responses are analyzed. 
-  Malicious packets are sent, and the response is checked for indicators of whether it has been blocked, rejected, or detected. 
-  To identify a WAF, a similar process is followed, but an attempt is made to interpret the response and classify it based on known patterns of IDS and WAFs.

### HTTPS
• Se suele asumir que una conexión HTTPS es segura.
• Un atacante que intercepte un mensaje solo recibirá bits sin sentido.
• Como siempre, esto no es así ya que el servidor HTTPS debe estar
correctamente configurado.
• A lo largo de los años se han descubierto un número razonable de
vulnerabilidades en la implementación de los protocolos SSL y TLS.
• Es primordial, comprobar la seguridad de las conexiones en
aplicaciones web.

The first step is to find out the configuration of the HTTPS server:
• nmap -sT -p 443 --script ssl-enum-ciphers (HOST)
• sslscan (HOST)
• testssl (HOST)
• sslyze –regular (HOST)
• openssl s_client –connect (HOST):443

Nmap, SSLScan, and TestSSL operate in a similar manner by sending multiple connections to the HTTPS server with different ciphers and configurations.

Some notes to consider:

- The SSL protocol has been discouraged since 2015.
- Avoid the use of the RC4 and DES ciphers along with SHA and MD5 hashes.
- TLS is the successor to SSL, with the current version being 1.3. It is advisable to avoid versions 1.1 and earlier.
- The certificate should not be self-signed and should be protected by a robust algorithm.

When a browser connects to a server that uses HTTPS, information about which ciphers and configurations each supports is exchanged, and the most robust configuration is established.
• If an attacker successfully performs a Man-in-the-Middle (MITM) attack on a poorly configured server, the attacker can deceive the server into believing that the client only supports a weak cipher.
• The connection will then be established with that server, allowing the attacker to capture and decrypt it later.



## Code inspection
You can use the browser itself to inspect the code, although there are also plugins and applications that facilitate this task.
• It is important to be able to analyze the components of the web application: HTML, CSS, tables, and divs, Document Object Model (DOM) objects, error codes.
• It is also useful to view the request-response communication between the server and the client.

With the browser, we can modify a page once it's loaded, although if we refresh, the request will be made again, and the server's version will be displayed.
• Hidden fields that set certain default values can be found.
• This is useful for bypassing client-side controls.

In Firefox, we have:
• Inspector: displays HTML elements in a hierarchy.
• Console: shows errors, warnings, and other messages generated by the page.
• Debugger: complete HTML code, breakpoints, variable modification.
• Style Editor: view and modify CSS.
• Performance: resources used by static and dynamic elements.
• Memory: captures the memory state of the process.
• Network: requests and responses to and from the server.
• Storage: mainly cookies.
• Others: DOM, Shader Editor, Canvas, Web Audio, Scratchpad.


## Cookies
• Cookies are small pieces of data that the server sends to the client to store locally.
• The information in cookies is often related to the client.
• They are commonly used to store interface style, preferences, previous activity, and, most importantly, session identifiers.
• The storage tab may not be enabled by default.
• This tab allows us to view, modify, delete, and add new cookies.

#### Interesting cookie values:
### HttpOnly:

- **Purpose:**
    
    - The HttpOnly attribute is a security feature that is designed to help mitigate the risk of Cross-Site Scripting (XSS) attacks.
    - When a cookie is marked as HttpOnly, it cannot be accessed or manipulated by client-side scripts running within the browser. This includes JavaScript.
- **Protection Against XSS:**
    
    - XSS attacks often involve injecting malicious scripts into web pages, which can then steal sensitive information, such as session cookies.
    - By setting the HttpOnly flag, the browser ensures that the cookie is not accessible to these scripts, making it more challenging for attackers to steal session data.
### Secure:

- **Purpose:**
    
    - The Secure attribute is a security measure to ensure that the cookie is only transmitted over secure, encrypted channels (HTTPS).
    - If a cookie is marked as Secure, it will only be sent to the server if the connection is made over HTTPS.
- **Preventing Data Exposure:**
    
    - This attribute helps protect sensitive information, such as session identifiers, from being exposed over unencrypted connections.
    - Without the Secure attribute, cookies may be transmitted over insecure HTTP connections, making them susceptible to interception by attackers using techniques like Man-in-the-Middle (MitM) attacks
    
### Expires (or Max-Age or SameSite):

- **Purpose:**
    
    - The Expires attribute specifies a date and time when the cookie will expire.
    - If the cookie does not have an expiration date, it is considered a session cookie and will be discarded when the user closes the browser.
    - Max-Age is an alternative to Expires, specifying the maximum age of the cookie in seconds.
    - SameSite is another attribute that controls when the cookie should be sent in a cross-site request.
- **Mitigating Session Hijacking:**
    
    - If a cookie has a long expiration time or no expiration at all, it increases the risk of session hijacking.
    - An attacker who manages to steal such a cookie can use it for an extended period, posing a security threat to the user's session.
    - Setting a reasonable expiration time helps mitigate this risk by ensuring that even if a cookie is stolen, it will become invalid after a certain period.


## Files and Directories
• In a web service, it's necessary to navigate through all the links present in the web application and note all visited files.
• There are tools to automate this task: crawlers and spiders.
• They explore all links and external files, even filling out forms, saving requests and responses for later analysis.
• Just like when scanning ports, we can't focus only on the most common ones; we need to scan everything.

• It's crucial to know if there is any accessible page or directory not shown to the user in normal navigation.
• Examples could include an intranet page or the administration of the CMS.
• Finding a resource of this kind can open up new possibilities for penetration testing.
#### robots.txt
• The robots.txt file can be a good source of information.
• The robots.txt file is used by web servers to tell search engines which directories or files they should or should not index.
• From an attacker's perspective, this tells us exactly which resources are accessible but not visible to other users.
• This is called security through obscurity and is not a very good idea.



## Tools
### DirBuster
DirBuster is a tool designed to discover, either through brute force or using a wordlist, files and directories on a web server.
• DirBuster responds with a list of codes returned by the server.
• It combines a crawler with brute force exploration:
  - It can follow all the links it finds.
  - It can try resource names to see if any exist.


• To determine if a resource exists, DirBuster uses the server's response code:
  - 200 OK: The file exists and can be read.
  - 404 File not found: The file does not exist.
  - 301 Moved permanently: The file is in another location.
  - 401 Unauthorized: Authentication required to access the file.
  - 403 Forbidden: The server refuses to respond to that request.
• There is a simpler tool called dirb.

### Owasp ZAP
• OWASP Zed Attack Proxy (ZAP) is a versatile tool for testing web security.
• It serves as a proxy, a passive and active vulnerability scanner, a fuzzer, a spider, and can send HTTP requests, among other things.
• A proxy is an application that acts as an intermediary between a client and a server. The client's requests are captured by the proxy and sent to the server.
• ZAP has an internal implementation of DirBuster: Forced Browse.

### Burpsuite
• Burp Suite is a toolkit for web security testing: proxy, fuzzer, request automator, string encoding and decoding, vulnerability scanner (Pro), and plugins that extend functionality.
• With Intruder, you can achieve an alternative to ZAP's Forced Browse in Burp Suite.
• Burp Intruder is a tool that allows you to automatically resend requests, modifying parts of the request.